# TODO: Ensure antidote is installed by Brewfile through chezmoi
source $(brew --prefix)/opt/antidote/share/antidote/antidote.zsh
# plugins in .zsh_plugins.txt
antidote load

export FZF_DEFAULT_COMMAND='ag -g ""'
# source "${ZSH}/custom/plugins/fzf-custom/base16-material-darker.config"
export FZF_DEFAULT_OPTS="$FZF_DEFAULT_OPTS --reverse --inline-info"

# TODO: Remove GPG, I don't think I need it anymore
# export GPG_TTY=$(tty)

source ~/.zsh_aliases

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

unsetopt share_history


# TODO: Refactor this go stuff to somewhere
export PATH="$(brew --prefix)/bin:$PATH"
export GOBIN="$HOME/go/bin"
export PATH="$PATH:$GOBIN"
export PATH="$PATH:$HOME/.local/bin"
export PATH="$PATH:$(brew --prefix)/opt/python/libexec/bin"

eval "$(nodenv init -)"

export COLORTERM=truecolor

[[ $(brew --prefix)/bin/kubectl ]] && source <(kubectl completion zsh)


# TODO: Where to put this
export JQ_COLORS='0;31:0;31:1;37:0;37:0;32:1;37:1;37'
export LANG=en_US.UTF-8


# --- Bash-like refinement for TAB ---
# unsetopt MENU_COMPLETE       # Don't insert the first match automatically
# setopt AUTO_LIST             # List when ambiguous
# setopt LIST_AMBIGUOUS        # Only list if more than one match
# setopt COMPLETE_IN_WORD      # Allow completion in the middle of a word
#

bindkey              '^I'         menu-select
bindkey "$terminfo[kcbt]" reverse-menu-select


zstyle ':autocomplete:*complete*:*' insert-unambiguous yes
zstyle ':completion:*:*' matcher-list 'm:{[:lower:]-}={[:upper:]_}' '+r:|[.]=**'

builtin zstyle ':autocomplete:*:unambiguous' format \
    $'%{\e[0;2m%}%Bcommon substring:%b %0F%11K%d%f%k'
#
# # Optional: Make TAB itself go directly into fzf-tab instead of bash-like completion
# # bindkey '^I' fzf-tab-complete
#
# # Customize fzf-tab appearance
# zstyle ':fzf-tab:*' fzf-preview 'less ${(Q)realpath}'
# zstyle ':fzf-tab:*' switch-group ',' '.'   # group switching keys
#
# # Example: colorize git branch completion
# zstyle ':completion:*:git-checkout:*' sort false
# zstyle ':completion:*:git-checkout:*' fzf-preview \
#   'git log --oneline --color=always --date=short --decorate=short -n 20 -- {}'
#
# # --- Git status files ---
# # Preview diff of a file when completing in git commands like add/checkout
# zstyle ':completion:*:git-(add|checkout|restore):*' fzf-preview \
#   'git diff --color=always -- {} | head -n 200'
#
